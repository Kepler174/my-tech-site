---
slug: git-04-03-access-control
title: "4.3 Access Control — 基于 SSH 的身份验证"
authors: [yeezi]
tags: [git, progit, SSH, 权限]
date: 2025-01-11T11:00:00
---

既然我们决定使用 SSH 协议作为主要的写入方式（大部分企业和私有项目的选择），那么管理 **公钥 (Public Keys)** 就成了必修课。

对于大多数 Linux 用户来说，这可能是老生常谈，但对于 Git 服务器的维护者来说，理解这个机制至关重要。

<!--truncate-->

### SSH 密钥原理 (简版)

SSH 使用非对称加密。每个用户有一对文件：
1.  **私钥 (Private Key)**：`id_rsa`。在这个世界上**绝对不要**给任何人看，必须死死锁在你的个人电脑里。
2.  **公钥 (Public Key)**：`id_rsa.pub`。这个可以贴在公告板上，给你的服务器，给 GitHub。

当你的电脑连接服务器时，服务器会用你的**公钥**出一道经过加密的数学题，如果你能用你的**私钥**解开，服务器就相信你是你。

### 生成密钥

如果在你的 `~/.ssh` 目录里找不到 `.pub` 文件，你可以用下面的命令生成：

```bash
$ ssh-keygen -t ed25519 -C "your_email@example.com"
```
*(现在的推荐算法是 `ed25519`，比老的 `rsa` 更安全也更快。)*

### 简单的多用户管理

假设你只是想搭建一个小型的 Git 服务器给几个朋友用，不想搞复杂的 LDAP 或数据库。
你可以利用 Linux 自带的 `authorized_keys` 机制。

1.  在服务器上创建一个专门的 `git` 用户。
2.  收集所有朋友的公钥 (`.pub` 文件内容)。
3.  把这些内容通过换行符分隔，在这个 Git 用户的 `~/.ssh/authorized_keys` 文件中列出来。

```bash
# 服务器上的 /home/git/.ssh/authorized_keys
ssh-ed25519 AAAAC3NzaC... friend1@email.com
ssh-ed25519 AAAAC3NzaC... friend2@email.com
ssh-ed25519 AAAAC3NzaC... friend3@email.com
```

**就这么简单。**
现在，只要他们持有对应的私钥，就可以通过 `git clone git@your-server:project.git` 来访问代码了。

这种方式的优点是**零成本**，不需要额外的软件。
缺点是**权限粒度太粗**。所有在列表里的人都拥有对所有仓库的读写权限（因为他们都登录为 `git` 用户）。如果需要更细粒度的控制（比如实习生只能读不能写），你就需要引入像 **Gitolite** 这样的工具，或者直接使用 GitLab。
