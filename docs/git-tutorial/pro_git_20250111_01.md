---
slug: git-04-01-protocols
title: "4.1 Git Protocols — 数据传输的四种管道"
authors: [yeezi]
tags: [git, progit, 协议, 服务器]
date: 2025-01-11T09:00:00
---

到了这一章，我们开始进入“深水区”。在前几章，你可能只在那台写代码的笔记本上操作 Git，或者只是简单地 `push` 到 GitHub。但如果你想在公司内部搭建 Git 服务，或者这仅仅是为了满足你作为工程师的好奇心——你想知道 Git 在网络上到底是怎么“说话”的，那么这一章就是为你准备的。

Git 在传输数据时，通常使用四种主要的协议：**本地协议 (Local)**、**HTTP 协议**、**SSH 协议** 和 **Git 协议**。

作为一个系统管理员或技术负责人，选择哪种协议直接决定了你团队的开发体验和安全级别。

<!--truncate-->

### 1. 本地协议 (Local Protocol)

这是最基础的。当你把一个硬盘上的文件夹作为远程仓库时，你就用到了本地协议。
比如，你有一个挂载的 NFS 共享盘：

```bash
$ git clone /srv/git/project.git
```

或者显式地使用 `file://`：

```bash
$ git clone file:///srv/git/project.git
```

**优缺点：**
*   **优点**：极其简单。利用现有的文件权限控制，不需要任何网络配置。
*   **缺点**：如果你不在同一台机器上，你需要挂载网络共享（NFS/SMB），这通常比其他网络协议要慢，且配置麻烦。

### 2. HTTP 协议 (Smart HTTP)

这是目前最流行的协议。你在 GitHub 上用的 `https://` 就是它。
在 Git 1.6.6 之前，HTTP 协议非常笨重（Dumb HTTP），只读且慢。但现在的 **Smart HTTP** 极其智能。

它运行起来就像是从 URL `clone` 或 `push` 一样简单。服务器会根据你的请求，启用 `git-upload-pack` 或 `git-receive-pack` 进程来高效传输数据。

**优缺点：**
*   **优点**：
    1.  **防火墙友好**：只用标准的 80/443 端口，几乎所有公司的网络都允许。
    2.  **验证简单**：直接复用 Web 服务器的 Basic Auth 或 OAuth。
*   **缺点**：
    1.  **性能**：虽然已经很快了，但在传输超大仓库时，有时候仍略逊于 SSH。
    2.  **凭证管理**：如果没有配置好凭证助手（OSX Keychain 或 Git Credential Manager），每次推送都要输入密码会让人抓狂。

### 3. SSH 协议 (Secure Shell)

这是 Linux/Unix 环境下的事实标准。如果你自己在服务器上搭建 Git，大概率会用这个。

```bash
$ git clone user@server:project.git
```

**优缺点：**
*   **优点**：
    1.  **安全**：基于公钥加密，久经考验。
    2.  **高效**：数据传输前会压缩，效率极高。
    3.  **写权限控制**：天然支持。有 SSH 权限就能推，没有就不能。
*   **缺点**：
    1.  **匿名访问困难**：SSH 默认是需要验证身份的。如果你通过 SSH 提供开源项目的匿名读取服务，配置起来会非常痛苦。

### 4. Git 协议

这是一个包含在 Git 软件包中的特殊守护进程。它监听 9418 端口。
它没有身份验证功能。

**优缺点：**
*   **优点**：**极快**。它是最快的传输协议，因为它不加密，没有握手开销。适合用于公开项目的只读镜像。
*   **缺点**：**不安全**。因为它没有身份验证，所以任何人都能推代码（如果你开了写权限）。所以通常永远不要用它来做推送协议。

### 专家的选择

*   **对于公共开源项目**：Smart HTTP 是首选（方便用户克隆），如果追求极致速度，可以辅以 Git 协议。
*   **对于由于内部私有项目**：SSH 是开发者的最爱（配置好 Key 之后就不用管了），Smart HTTP 是 IT 部门的最爱（易于管理和审计）。
