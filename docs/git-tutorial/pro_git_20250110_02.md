---
slug: git-03-02-basic-branching-merging
title: "3.2 分支的新建与合并 — 工作的日常"
authors: [yeezi]
tags: [git, progit, 合并, 冲突]
date: 2025-01-10T10:00:00
---

我们来模拟一个真实的开发场景。哪怕你是独自开发，这个流程也是非常有价值的。
在这个场景中，你将学会如何创建一个修 Bug 的分支，如何合并它，以及遇到那个人人闻之色变的“合并冲突”时该怎么办。

<!--truncate-->

### 场景模拟

你正在做一个网站项目，在 `master` 分支上写得正嗨。突然，接到了一个紧急电话：线上有一个严重的 Bug（Issue #53）需要马上修复。

此时你当然不能把你手头写了一半的代码直接发上线。你需要一个干净的环境。

#### 1. 新建分支
```bash
$ git checkout -b iss53
// -b 参数相当于 git branch iss53 加上 git checkout iss53
```
现在你进入了一个新的平行宇宙 `iss53`。你可以放心地修改代码，修好 Bug，提交 commit。

```bash
$ git commit -am "fixed the broken email system"
```

#### 2. 合并 (Merge)
Bug 修好了，测试通过了。现在要把这个修复合并回主线 `master`，准备发布。

```bash
$ git checkout master
$ git merge iss53
```

**情况 A：快进合并 (Fast-forward)**
如果 `master` 在你切走之后没有任何新的提交，Git 会简单地把 `master` 指针顺着时间线向前挪到 `iss53` 的位置。这叫“快进”。

**情况 B：三方合并 (3-way Merge)**
如果在你修 Bug 的时候，你自己（或者队友）在 `master` 上也提交了别的代码。这时候两条线叉开了。
Git 会很聪明地找到这两个分支的“最近共同祖先”，然后把 分支A、分支B 和 祖先 进行三方比对，自动生成一个新的 commit（Merge Commit）把它们连起来。

### 解决冲突 (Conflicts)

这是新手最怕的时刻：屏幕上出现 `CONFLICT` 字样，自动合并失败。

别慌。冲突不是错误，它只是 Git 在问你问题。
“嘿，你在 `master` 里把这行改成了A，在 `iss53` 里把它改成了B，我不知道该听谁的，你来定。”

打开那个冲突的文件，你会看到：

```html
<<<<<<< HEAD
<div id="footer">contact : email.support@github.com</div>
=======
<div id="footer">
 please contact us at support@github.com
</div>
>>>>>>> iss53
```

Git 把两个版本都列出来了，用 `=======` 隔开。
解决冲突不需要什么魔法命令，你只需要：
1.  **编辑文件**，删掉那些 `<<<<`、`====`、`>>>>` 标记。
2.  留下你想要的代码（或者两个都留，或者重写）。
3.  保存文件。
4.  **`git add <file>`** （告诉 Git 我搞定了）。
5.  **`git commit`**。

### 总结

*   分支是用来隔离工作的。
*   `git checkout -b` 是最顺手的起手式。
*   遇到冲突别害怕，那只是 Git 把决策权交还给了你。
*   完成合并后，记得删除那个临时的修 Bug 分支：`git branch -d iss53`，保持环境整洁。
