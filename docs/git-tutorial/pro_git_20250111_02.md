---
slug: git-04-02-bare-repository
title: "4.2 Bare Repository — 纯粹的数据中心"
authors: [yeezi]
tags: [git, progit, 裸仓库, 服务端]
date: 2025-01-11T10:00:00
---

在开始搭建服务器之前，我们必须先澄清一个核心概念：**裸仓库 (Bare Repository)**。

很多初学者在服务器上初始化仓库时，习惯性地输了 `git init`。
然后他在本地电脑上 `git push server master`，结果 Git 报错了：
*"refusing to update checked out branch: pointed to by HEAD"*

这时候他会很困惑：“我在服务器上已经建好仓库了啊？”

<!--truncate-->

### 什么是裸仓库？

普通的 Git 仓库（你平时干活的地方）由两部分组成：
1.  **.git 目录**：存放历史数据、对象、引用等。
2.  **工作目录 (Working Directory)**：存放检出的文件（那些 `.c`, `.js`, `.md` 文件），供你编辑。

而 **裸仓库 (Bare Repository)**，就是**没有工作目录**的仓库。
它里面只有 `.git` 目录里的内容。通常，裸仓库的目录名以 `.git` 结尾，例如 `project.git`。

### 为什么服务器需要裸仓库？

试想一下，如果远程服务器是一个普通的仓库，这意味着服务器上有一个“当前检出的分支”（比如 master），并且硬盘上铺满了源代码文件。

当你从本地向服务器 `push` 代码时，你试图更新服务器的 `.git` 数据库，让 master 分支指向新的提交。
**但是！** 服务器的工作目录里的文件还停留在旧版本。这就造成了**数据库**和**文件**的不一致。
Git 为了保护数据（防止服务器上有人正在修改的文件被你覆盖），会阻止这种推送。

所以，作为 **协作中心** 的服务器仓库，**不应该有人在上面直接编辑代码**。它应该只是一个被动的、纯粹的数据接收容器。
这就是裸仓库存在的意义。

### 如何创建裸仓库？

非常简单，加一个 `--bare` 参数：

```bash
$ git init --bare project.git
```

或者，如果你想把现有的项目导出成一个裸仓库放到服务器上：

```bash
$ git clone --bare my_project project.git
```

这就是搭建 Git 服务器的第一步。无论你后面是用 SSH 还是 HTTP，所有的远程仓库，本质上都是一个个放在服务器某个文件夹里的裸仓库。
